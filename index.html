<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Figure Export Tool v3.3 - Turner Engineering Corporation</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo-section">
                    <img src="tenco-logo.png" alt="Turner Engineering Corporation" class="company-logo" onerror="this.style.display='none'">
                </div>
                <div class="title-section">
                    <h1>Figure Export Tool v3.3</h1>
                    <p class="subtitle">Professional EMC Testing Annotation System</p>
                    <p class="company-name">Turner Engineering Corporation</p>
                </div>
            </div>
        </header>

        <!-- Page Management -->
        <div class="page-management">
            <div class="page-tabs" id="pageTabs">
                <div class="page-tab active" data-page="1">
                    <span>Page 1</span>
                    <button class="close-tab" onclick="figureExportTool.removePage(1)" title="Close Page">Ã—</button>
                </div>
            </div>
            <button class="add-page-btn" id="addPageBtn" onclick="figureExportTool.addNewPage()">+ Add Page</button>
        </div>

        <div class="main-content">
            <!-- Left Panel: Controls -->
            <div class="left-panel">
                <!-- Data Input Type Selection -->
                <div class="input-type-control">
                    <h2>Data Input Type</h2>
                    <div class="input-type-toggle">
                        <label>
                            <input type="radio" name="inputType" value="images" checked>
                            <span>ðŸ“· Image Files</span>
                        </label>
                        <label>
                            <input type="radio" name="inputType" value="csv">
                            <span>ðŸ“Š CSV Data Files</span>
                        </label>
                    </div>
                </div>

                <div class="layout-control">
                    <h2>Layout Options</h2>
                    <div class="layout-toggle">
                        <label>
                            <input type="radio" name="layout" value="horizontal" checked>
                            <span>Side by Side</span>
                        </label>
                        <label>
                            <input type="radio" name="layout" value="vertical">
                            <span>Stacked</span>
                        </label>
                    </div>
                </div>

                <!-- Image Upload Section -->
                <div class="upload-section" id="imageUploadSection">
                    <h2>Upload Images</h2>
                    <div class="dual-upload" id="dualUpload">
                        <div class="upload-container">
                            <h3>Image 1</h3>
                            <div class="upload-area" id="uploadArea1">
                                <input type="file" id="imageInput1" accept="image/*" style="display: none;">
                                <div class="upload-placeholder">
                                    <p>Click to select or drag & drop</p>
                                </div>
                            </div>
                        </div>
                        <div class="upload-container">
                            <h3>Image 2</h3>
                            <div class="upload-area" id="uploadArea2">
                                <input type="file" id="imageInput2" accept="image/*" style="display: none;">
                                <div class="upload-placeholder">
                                    <p>Click to select or drag & drop</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CSV Upload Section -->
                <div class="upload-section" id="csvUploadSection" style="display: none;">
                    <h2>Upload CSV Data Files</h2>
                    
                    <!-- CSV Display Mode Toggle -->
                    <div class="csv-mode-control">
                        <h3>Display Mode</h3>
                        <div class="csv-mode-toggle">
                            <label>
                                <input type="radio" name="csvMode" value="separate" checked>
                                <span>ðŸ“Š Separate Graphs</span>
                            </label>
                            <label>
                                <input type="radio" name="csvMode" value="overlay">
                                <span>ðŸ“ˆ Overlay Comparison</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Separate Mode Upload Areas -->
                    <div class="dual-upload" id="dualCsvUpload">
                        <div class="upload-container">
                            <h3>CSV File 1</h3>
                            <div class="upload-area" id="csvUploadArea1">
                                <input type="file" id="csvInput1" accept=".csv,.txt" style="display: none;">
                                <div class="upload-placeholder">
                                    <p>Click to select CSV file</p>
                                    <small>Frequency vs Amplitude data</small>
                                </div>
                            </div>
                            <div class="csv-info" id="csvInfo1" style="display: none;">
                                <p><strong>Rows:</strong> <span class="csv-rows">-</span></p>
                                <p><strong>Frequency Range:</strong> <span class="csv-freq-range">-</span></p>
                            </div>
                        </div>
                        <div class="upload-container">
                            <h3>CSV File 2</h3>
                            <div class="upload-area" id="csvUploadArea2">
                                <input type="file" id="csvInput2" accept=".csv,.txt" style="display: none;">
                                <div class="upload-placeholder">
                                    <p>Click to select CSV file</p>
                                    <small>Frequency vs Amplitude data</small>
                                </div>
                            </div>
                            <div class="csv-info" id="csvInfo2" style="display: none;">
                                <p><strong>Rows:</strong> <span class="csv-rows">-</span></p>
                                <p><strong>Frequency Range:</strong> <span class="csv-freq-range">-</span></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Overlay Mode Upload Area -->
                    <div class="single-upload" id="singleCsvUpload" style="display: none;">
                        <div class="upload-container overlay-upload">
                            <h3>CSV Files for Overlay Comparison</h3>
                            <div class="upload-area" id="csvOverlayUploadArea">
                                <input type="file" id="csvOverlayInput" accept=".csv,.txt" multiple style="display: none;">
                                <div class="upload-placeholder">
                                    <p>Click to select multiple CSV files</p>
                                    <small>Hold Ctrl/Cmd to select multiple files</small>
                                    <small>All files will be overlaid on one graph</small>
                                </div>
                            </div>
                            <div class="csv-overlay-files" id="csvOverlayFiles">
                                <h4>Loaded Files:</h4>
                                <div class="file-list" id="overlayFileList">
                                    <!-- File list will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dual-form-section" id="dualFormSection">
                    <div class="form-container">
                        <h3>Image 1 Information</h3>
                        <div class="form-group">
                            <label for="runId1">Run ID:</label>
                            <input type="text" id="runId1" placeholder="e.g., 127-71">
                        </div>
                        <div class="form-group">
                            <label for="band1">Band:</label>
                            <input type="text" id="band1" placeholder="e.g., B6">
                        </div>
                        <div class="form-group">
                            <label for="location1">Location:</label>
                            <input type="text" id="location1" placeholder="e.g., Ambient">
                        </div>
                    </div>
                    
                    <div class="form-container">
                        <h3>Image 2 Information</h3>
                        <div class="form-group">
                            <label for="runId2">Run ID:</label>
                            <input type="text" id="runId2" placeholder="e.g., 127-71">
                        </div>
                        <div class="form-group">
                            <label for="band2">Band:</label>
                            <input type="text" id="band2" placeholder="e.g., B6">
                        </div>
                        <div class="form-group">
                            <label for="location2">Location:</label>
                            <input type="text" id="location2" placeholder="e.g., Ambient">
                        </div>
                    </div>
                </div>

                <div class="actions-section">
                    <h2>Actions</h2>
                    <div class="export-buttons">
                        <button id="exportImage1" class="btn btn-primary">Export Image 1</button>
                        <button id="exportImage2" class="btn btn-primary">Export Image 2</button>
                        <button id="exportBoth" class="btn btn-primary">Export Both Images</button>
                        <button id="exportAllPages" class="btn btn-secondary">Export All Pages</button>
                    </div>
                    <button id="clearStats" class="btn btn-secondary">Clear Current Page</button>
                    <button id="clearAllPages" class="btn btn-warning">Clear All Pages</button>
                </div>
            </div>

            <!-- Center Panel: Dual Images -->
            <div class="center-panel">
                <!-- Information Tables Above Images -->
                <div class="dual-info-tables" id="dualInfoTables">
                    <div class="info-table">
                        <h4 id="dataType1Header">Image 1</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Run</th>
                                    <th>Band</th>
                                    <th>Location</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td id="tableRun1">-</td>
                                    <td id="tableBand1">-</td>
                                    <td id="tableLocation1">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="info-table">
                        <h4 id="dataType2Header">Image 2</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Run</th>
                                    <th>Band</th>
                                    <th>Location</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td id="tableRun2">-</td>
                                    <td id="tableBand2">-</td>
                                    <td id="tableLocation2">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Dual Data Container (Images or CSV Graphs) -->
                <div class="dual-data-container" id="dualDataContainer">
                    <!-- Image Display Container -->
                    <div class="dual-image-container" id="dualImageContainer">
                        <div class="image-container">
                            <canvas id="annotationCanvas1"></canvas>
                            <div class="instruction-overlay" id="instructionOverlay1">
                                <p>Upload Image 1</p>
                            </div>
                        </div>
                        <div class="image-container">
                            <canvas id="annotationCanvas2"></canvas>
                            <div class="instruction-overlay" id="instructionOverlay2">
                                <p>Upload Image 2</p>
                            </div>
                        </div>
                    </div>

                    <!-- CSV Graph Container -->
                    <div class="dual-csv-container" id="dualCsvContainer" style="display: none;">
                        <!-- Separate Graphs Mode -->
                        <div class="csv-separate-mode" id="csvSeparateMode">
                            <div class="csv-container">
                                <div class="csv-graph-header">
                                    <h4>CSV Data 1</h4>
                                    <div class="graph-controls">
                                        <button class="control-btn" onclick="figureExportTool.resetZoomCsv(1)">Reset Zoom</button>
                                        <button class="control-btn" onclick="figureExportTool.autoScaleCsv(1)">Auto Scale</button>
                                        <button class="control-btn" onclick="figureExportTool.enterFullScreenCsv(1)" title="Full Screen">â›¶</button>
                                    </div>
                                </div>
                                <canvas id="csvGraphCanvas1"></canvas>
                                <div class="instruction-overlay" id="csvInstructionOverlay1">
                                    <p>Upload CSV File 1</p>
                                    <small>Expected format: Frequency, Amplitude</small>
                                </div>
                            </div>
                            <div class="csv-container">
                                <div class="csv-graph-header">
                                    <h4>CSV Data 2</h4>
                                    <div class="graph-controls">
                                        <button class="control-btn" onclick="figureExportTool.resetZoomCsv(2)">Reset Zoom</button>
                                        <button class="control-btn" onclick="figureExportTool.autoScaleCsv(2)">Auto Scale</button>
                                        <button class="control-btn" onclick="figureExportTool.enterFullScreenCsv(2)" title="Full Screen">â›¶</button>
                                    </div>
                                </div>
                                <canvas id="csvGraphCanvas2"></canvas>
                                <div class="instruction-overlay" id="csvInstructionOverlay2">
                                    <p>Upload CSV File 2</p>
                                    <small>Expected format: Frequency, Amplitude</small>
                                </div>
                            </div>
                        </div>

                        <!-- Overlay Comparison Mode -->
                        <div class="csv-overlay-mode" id="csvOverlayMode" style="display: none;">
                            <div class="csv-overlay-container">
                                <div class="csv-graph-header">
                                    <h4>Spectrum Comparison</h4>
                                    <div class="graph-controls">
                                        <button class="control-btn" onclick="figureExportTool.resetZoomOverlay()">Reset Zoom</button>
                                        <button class="control-btn" onclick="figureExportTool.autoScaleOverlay()">Auto Scale</button>
                                        <button class="control-btn" onclick="figureExportTool.exportOverlayData()" title="Export Overlay">ðŸ“¤</button>
                                        <button class="control-btn" onclick="figureExportTool.enterFullScreenOverlay()" title="Full Screen">â›¶</button>
                                    </div>
                                </div>
                                <canvas id="csvOverlayCanvas"></canvas>
                                <div class="instruction-overlay" id="csvOverlayInstructionOverlay">
                                    <p>Upload CSV files to see overlay comparison</p>
                                    <small>Multiple datasets will be displayed with different colors</small>
                                </div>
                                <div class="csv-legend" id="csvLegend">
                                    <h5>Legend</h5>
                                    <div class="legend-items" id="legendItems">
                                        <!-- Legend items will be added dynamically -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Comments and Band Selection -->
            <div class="right-panel">
                <!-- Comments Section -->
                <div class="comments-section">
                    <h3>Comments</h3>
                    <div class="form-group">
                        <textarea id="comments" placeholder="Additional notes, observations, test conditions, anomalies, or other relevant information..."></textarea>
                    </div>
                </div>
                
                <!-- Limit Lines Configuration -->
                <div class="limit-lines-section">
                    <h3>NYCT AC Train Emission Limits</h3>
                    <div class="limit-controls">
                        <label>
                            <input type="checkbox" id="showLimitLines" checked>
                            Show Limit Lines on CSV Graphs
                        </label>
                        <div class="distance-controls">
                            <label for="distanceSelect">Distance:</label>
                            <select id="distanceSelect">
                                <option value="50ft">50 ft</option>
                                <option value="100ft">100 ft</option>
                            </select>
                        </div>
                        <button class="btn btn-small" onclick="figureExportTool.resetLimitsToDefaults()">Reset to NYCT Defaults</button>
                    </div>
                    <div class="limit-table-container">
                        <table class="limit-table" id="limitTable">
                            <thead>
                                <tr>
                                    <th>Band</th>
                                    <th>Frequency Range</th>
                                    <th>Limit (dBÎ¼V/m/MHz)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr data-band="B0">
                                    <td><strong>B0</strong></td>
                                    <td>10 kHz â€“ 160 kHz</td>
                                    <td><input type="number" class="limit-input" data-band="B0" value="126" step="0.1"></td>
                                </tr>
                                <tr data-band="B1">
                                    <td><strong>B1</strong></td>
                                    <td>150 kHz â€“ 650 kHz</td>
                                    <td><input type="number" class="limit-input" data-band="B1" value="126" step="0.1"></td>
                                </tr>
                                <tr data-band="B2">
                                    <td><strong>B2</strong></td>
                                    <td>500 kHz â€“ 3 MHz</td>
                                    <td><input type="number" class="limit-input" data-band="B2" value="115" step="0.1"></td>
                                </tr>
                                <tr data-band="B3">
                                    <td><strong>B3</strong></td>
                                    <td>2.5 MHz â€“ 7.5 MHz</td>
                                    <td><input type="number" class="limit-input" data-band="B3" value="100" step="0.1"></td>
                                </tr>
                                <tr data-band="B4">
                                    <td><strong>B4</strong></td>
                                    <td>5 MHz â€“ 30 MHz</td>
                                    <td><input type="number" class="limit-input" data-band="B4" value="85" step="0.1"></td>
                                </tr>
                                <tr data-band="B5">
                                    <td><strong>B5</strong></td>
                                    <td>25 MHz â€“ 325 MHz</td>
                                    <td><input type="number" class="limit-input" data-band="B5" value="81" step="0.1"></td>
                                </tr>
                                <tr data-band="B6">
                                    <td><strong>B6</strong></td>
                                    <td>300 MHz â€“ 1.3 GHz</td>
                                    <td><input type="number" class="limit-input" data-band="B6" value="96" step="0.1"></td>
                                </tr>
                                <tr data-band="B7">
                                    <td><strong>B7</strong></td>
                                    <td>1 GHz â€“ 6 GHz</td>
                                    <td><input type="number" class="limit-input" data-band="B7" value="96" step="0.1"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Peak Identification Helper -->
                <div class="peak-helper-section">
                    <h3>Peak Identification Helper</h3>
                    <div class="band-info-display">
                        <p class="helper-hint">Select an EMC band above to see frequency allocations for that range.</p>
                    </div>
                    <div class="peak-results" id="peakResults">
                        <p class="helper-hint">Choose a band (B0-B7) to view all services allocated in that frequency range.</p>
                    </div>
                </div>
                
                <!-- Enhanced Band Selection -->
                <div class="band-section">
                    <h2>EMC Band Selection</h2>
                    <div class="band-buttons">
                        <button class="band-btn" data-band="B0">B0</button>
                        <button class="band-btn" data-band="B1">B1</button>
                        <button class="band-btn" data-band="B2">B2</button>
                        <button class="band-btn" data-band="B3">B3</button>
                        <button class="band-btn" data-band="B4">B4</button>
                        <button class="band-btn" data-band="B5">B5</button>
                        <button class="band-btn" data-band="B6">B6</button>
                        <button class="band-btn" data-band="B7">B7</button>
                    </div>
                    <div class="frequency-range">
                        <label for="frequencyRange">Frequency Range:</label>
                        <input type="text" id="frequencyRange" readonly placeholder="Select a band to see frequency range">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <p>&copy; 2025 Turner Engineering Corporation. All rights reserved.</p>
                <p>Professional EMC Testing Tools | Enhanced CSV Analysis with Full Screen & Dynamic Grids v3.3</p>
                <div class="attribution">
                    <p>Developed by Howard Wang | Supervised by Temba Mateke</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Band Database Scripts (B0-B7) -->
    <script src="peak-identification-database-band0.js"></script>
    <script src="peak-identification-database-band1.js"></script>
    <script src="peak-identification-database-band2.js"></script>
    <script src="peak-identification-database-band3.js"></script>
    <script src="peak-identification-database-band4.js"></script>
    <script src="peak-identification-database-band5.js"></script>
    <script src="peak-identification-database-band6.js"></script>
    <script src="peak-identification-database-band7.js"></script>
    <script src="script.js"></script>
</body>
</html> 